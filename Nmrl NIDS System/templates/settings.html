<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NMRL NIDS - System Settings</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <style>
        .card {
            margin-bottom: 20px;
            transition: all 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .active-link {
            background-color: rgba(0,0,0,0.1);
            font-weight: bold;
        }
        .setting-section {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
        }
        .setting-section:last-child {
            border-bottom: none;
        }
        .settings-nav .nav-link {
            border-radius: 0;
            border-left: 3px solid transparent;
            padding: 10px 15px;
            transition: all 0.2s ease;
        }
        .settings-nav .nav-link.active {
            background-color: rgba(13, 110, 253, 0.1);
            border-left: 3px solid #0d6efd;
        }
        .settings-nav .nav-link:hover:not(.active) {
            background-color: rgba(0,0,0,0.05);
        }
        .form-switch .form-check-input {
            width: 3em;
            height: 1.5em;
        }
        .form-switch .form-check-input:checked {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }
        
        /* Dark theme styles */
        .dark-theme {
            background-color: #212529;
            color: #f8f9fa;
        }
        .dark-theme .card,
        .dark-theme .sidebar {
            background-color: #2c3034;
            color: #f8f9fa;
            border-color: #495057;
        }
        .dark-theme .table {
            color: #f8f9fa;
        }
        .dark-theme .table-hover tbody tr:hover {
            background-color: #3d4043;
            color: #f8f9fa;
        }
        .dark-theme .form-control,
        .dark-theme .form-select {
            background-color: #343a40;
            color: #f8f9fa;
            border-color: #495057;
        }
        .dark-theme .form-text {
            color: #adb5bd !important;
        }
        .dark-theme .border-bottom {
            border-bottom-color: #495057 !important;
        }
        .dark-theme .setting-section {
            border-bottom-color: #495057;
        }
    </style>
</head>
<body class="{{ theme_class }}">
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('dashboard') }}">
                                <i class="bi bi-speedometer2"></i> NMRL NIDS Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('traffic_monitor') }}">
                                <i class="bi bi-graph-up"></i> Traffic Monitor
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('anomalies') }}">
                                <i class="bi bi-exclamation-triangle"></i> Anomalies
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('alerts') }}">
                                <i class="bi bi-bell"></i> Alerts
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('model_management') }}">
                                <i class="bi bi-cpu"></i> Models
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active-link" href="{{ url_for('system_settings_page') }}">
                                <i class="bi bi-gear"></i> Settings
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">System Settings</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <button type="button" class="btn btn-primary me-2" id="saveSettings">
                            <i class="bi bi-save"></i> Save Changes
                        </button>
                        <button type="button" class="btn btn-outline-secondary" id="resetSettings">
                            <i class="bi bi-arrow-repeat"></i> Reset
                        </button>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3">
                        <div class="card">
                            <div class="card-header">
                                Settings Categories
                            </div>
                            <div class="card-body p-0">
                                <div class="settings-nav nav flex-column nav-pills" id="settings-tab" role="tablist">
                                    <a class="nav-link active" id="general-tab" data-bs-toggle="pill" href="#general" role="tab" aria-controls="general" aria-selected="true">
                                        <i class="bi bi-gear"></i> General
                                    </a>
                                    <a class="nav-link" id="network-tab" data-bs-toggle="pill" href="#network" role="tab" aria-controls="network" aria-selected="false">
                                        <i class="bi bi-hdd-network"></i> Network
                                    </a>
                                    <a class="nav-link" id="detection-tab" data-bs-toggle="pill" href="#detection" role="tab" aria-controls="detection" aria-selected="false">
                                        <i class="bi bi-shield-check"></i> Detection
                                    </a>
                                    <a class="nav-link" id="alerts-tab" data-bs-toggle="pill" href="#alerts-settings" role="tab" aria-controls="alerts-settings" aria-selected="false">
                                        <i class="bi bi-bell"></i> Alerts
                                    </a>
                                    <a class="nav-link" id="storage-tab" data-bs-toggle="pill" href="#storage" role="tab" aria-controls="storage" aria-selected="false">
                                        <i class="bi bi-database"></i> Storage
                                    </a>
                                    <a class="nav-link" id="users-tab" data-bs-toggle="pill" href="#users" role="tab" aria-controls="users" aria-selected="false">
                                        <i class="bi bi-people"></i> Users
                                    </a>
                                    <a class="nav-link" id="advanced-tab" data-bs-toggle="pill" href="#advanced" role="tab" aria-controls="advanced" aria-selected="false">
                                        <i class="bi bi-sliders"></i> Advanced
                                    </a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-header">
                                System Status
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <div>System Status</div>
                                    <span class="badge bg-success">Active</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <div>Last Update</div>
                                    <span>2023-11-15 14:30</span>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>Version</div>
                                    <span>1.2.5</span>
                                </div>
                                
                                <div class="d-grid gap-2 mt-3">
                                    <button class="btn btn-outline-primary btn-sm" id="checkUpdatesBtn">
                                        <i class="bi bi-cloud-arrow-up"></i> Check for Updates
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-9">
                        <div class="card">
                            <div class="card-body">
                                <div class="tab-content" id="settings-tabContent">
                                    <!-- General Settings -->
                                    <div class="tab-pane fade show active" id="general" role="tabpanel" aria-labelledby="general-tab">
                                        <h5 class="card-title">General Settings</h5>
                                        
                                        <div class="setting-section">
                                            <div class="mb-3">
                                                <label for="systemName" class="form-label">System Name</label>
                                                <input type="text" class="form-control" id="systemName" value="NMRL Network Intrusion Detection System">
                                                <div class="form-text">Name used for reports and notifications</div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="timezone" class="form-label">Timezone</label>
                                                <select class="form-select" id="timezone">
                                                    <option value="UTC">UTC</option>
                                                    <option value="America/New_York" selected>America/New_York</option>
                                                    <option value="America/Chicago">America/Chicago</option>
                                                    <option value="America/Denver">America/Denver</option>
                                                    <option value="America/Los_Angeles">America/Los_Angeles</option>
                                                    <option value="Europe/London">Europe/London</option>
                                                    <option value="Asia/Tokyo">Asia/Tokyo</option>
                                                    <option value="Africa/Douala">Central African Time (Africa/Douala)</option>
                                                </select>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="uiTheme" class="form-label">UI Theme</label>
                                                <select class="form-select" id="uiTheme">
                                                    <option value="light" selected>Light</option>
                                                    <option value="dark">Dark</option>
                                                    <option value="system">System Default</option>
                                                </select>
                                            </div>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="autoRefresh" checked>
                                                <label class="form-check-label" for="autoRefresh">Auto-refresh dashboards</label>
                                                <div class="form-text">Automatically refresh dashboards with latest data</div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="refreshInterval" class="form-label">Refresh Interval (seconds)</label>
                                                <input type="number" class="form-control" id="refreshInterval" value="5" min="1" max="60">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Network Settings -->
                                    <div class="tab-pane fade" id="network" role="tabpanel" aria-labelledby="network-tab">
                                        <h5 class="card-title">Network Settings</h5>
                                        
                                        <div class="setting-section">
                                            <div class="mb-3">
                                                <label for="networkInterface" class="form-label">Monitoring Interface</label>
                                                <select class="form-select" id="networkInterface">
                                                    <option value="all">All Interfaces</option>
                                                    <option value="eth0" selected>eth0</option>
                                                    <option value="eth1">eth1</option>
                                                    <option value="wlan0">wlan0</option>
                                                </select>
                                                <div class="form-text">Network interface to monitor for traffic</div>
                                            </div>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="promiscuousMode" checked>
                                                <label class="form-check-label" for="promiscuousMode">Promiscuous Mode</label>
                                                <div class="form-text">Capture all packets on the network segment</div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="captureFilter" class="form-label">Capture Filter</label>
                                                <input type="text" class="form-control" id="captureFilter" value="not port 22">
                                                <div class="form-text">BPF filter syntax to apply when capturing packets</div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="captureRate" class="form-label">Max Capture Rate (packets/sec)</label>
                                                <input type="number" class="form-control" id="captureRate" value="1000" min="100" max="10000">
                                                <div class="form-text">0 for unlimited</div>
                                            </div>
                                        </div>
                                        
                                        <div class="setting-section">
                                            <h6>IP Ranges</h6>
                                            
                                            <div class="mb-3">
                                                <label for="internalNetworks" class="form-label">Internal Networks</label>
                                                <textarea class="form-control" id="internalNetworks" rows="2">10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16</textarea>
                                                <div class="form-text">Comma-separated list of CIDR ranges for internal networks</div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="trustedNetworks" class="form-label">Trusted Networks</label>
                                                <textarea class="form-control" id="trustedNetworks" rows="2">10.1.0.0/16, 192.168.1.0/24</textarea>
                                                <div class="form-text">Networks with reduced monitoring sensitivity</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Detection Settings -->
                                    <div class="tab-pane fade" id="detection" role="tabpanel" aria-labelledby="detection-tab">
                                        <h5 class="card-title">Detection Settings</h5>
                                        
                                        <div class="setting-section">
                                            <div class="mb-3">
                                                <label for="preferredModel" class="form-label">Preferred Model</label>
                                                <select class="form-select" id="preferredModel">
                                                    <option value="autoencoder">Autoencoder</option>
                                                    <option value="kmeans" selected>K-Means</option>
                                                    <option value="isolation_forest">Isolation Forest</option>
                                                    <option value="ensemble">Ensemble (all models)</option>
                                                </select>
                                                <div class="form-text">Primary model used for anomaly detection</div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="detectionSensitivity" class="form-label">Detection Sensitivity</label>
                                                <select class="form-select" id="detectionSensitivity">
                                                    <option value="low">Low (fewer alerts, lower false positives)</option>
                                                    <option value="medium" selected>Medium (balanced)</option>
                                                    <option value="high">High (more alerts, higher false positives)</option>
                                                </select>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="anomalyThreshold" class="form-label">Anomaly Score Threshold</label>
                                                <input type="range" class="form-range" id="anomalyThreshold" min="0" max="1" step="0.05" value="0.7">
                                                <div class="d-flex justify-content-between">
                                                    <span>0.0 (Low)</span>
                                                    <span>0.7</span>
                                                    <span>1.0 (High)</span>
                                                </div>
                                            </div>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="automaticUpdates" checked>
                                                <label class="form-check-label" for="automaticUpdates">Automatic Model Updates</label>
                                                <div class="form-text">Automatically retrain models with new data</div>
                                            </div>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="dynamicThresholds" checked>
                                                <label class="form-check-label" for="dynamicThresholds">Dynamic Thresholds</label>
                                                <div class="form-text">Adjust detection thresholds based on network behavior</div>
                                            </div>
                                        </div>
                                        
                                        <div class="setting-section">
                                            <h6>Detection Rules</h6>
                                            
                                            <div class="mb-3">
                                                <label for="customRules" class="form-label">Custom Detection Rules</label>
                                                <textarea class="form-control" id="customRules" rows="3"># Example rule: alert on high port scanning
port_scan:
  threshold: 20
  timeframe: 60  # seconds
  action: alert</textarea>
                                                <div class="form-text">Custom detection rules in YAML format</div>
                                            </div>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="enableSignatures" checked>
                                                <label class="form-check-label" for="enableSignatures">Enable Signature-based Detection</label>
                                                <div class="form-text">Use pre-defined attack signatures in addition to anomaly detection</div>
                                            </div>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="enableHeuristics" checked>
                                                <label class="form-check-label" for="enableHeuristics">Enable Heuristic Detection</label>
                                                <div class="form-text">Use behavior-based heuristics for detecting anomalies</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Alerts Settings -->
                                    <div class="tab-pane fade" id="alerts-settings" role="tabpanel" aria-labelledby="alerts-tab">
                                        <h5 class="card-title">Alerts Settings</h5>
                                        
                                        <div class="setting-section">
                                            <div class="mb-3">
                                                <label for="alertThreshold" class="form-label">Minimum Alert Severity</label>
                                                <select class="form-select" id="alertThreshold">
                                                    <option value="low">Low (all alerts)</option>
                                                    <option value="medium">Medium</option>
                                                    <option value="high" selected>High (critical only)</option>
                                                </select>
                                                <div class="form-text">Minimum severity level to generate alerts</div>
                                            </div>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="emailAlerts" checked>
                                                <label class="form-check-label" for="emailAlerts">Email Alerts</label>
                                                <div class="form-text">Send alerts to the configured email addresses</div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="emailRecipients" class="form-label">Email Recipients</label>
                                                <input type="text" class="form-control" id="emailRecipients" value="admin@example.com, security@example.com">
                                                <div class="form-text">Comma-separated list of email addresses</div>
                                            </div>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="slackAlerts">
                                                <label class="form-check-label" for="slackAlerts">Slack Alerts</label>
                                            </div>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="webhookAlerts">
                                                <label class="form-check-label" for="webhookAlerts">Webhook Alerts</label>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="alertAggregation" class="form-label">Alert Aggregation</label>
                                                <select class="form-select" id="alertAggregation">
                                                    <option value="none">None (all alerts)</option>
                                                    <option value="similar" selected>Group similar alerts</option>
                                                    <option value="summary">Daily summary only</option>
                                                </select>
                                                <div class="form-text">How to aggregate multiple similar alerts</div>
                                            </div>
                                        </div>
                                        
                                        <div class="setting-section">
                                            <h6>Alert Actions</h6>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="autoBlockAttackers">
                                                <label class="form-check-label" for="autoBlockAttackers">Automatically Block Attackers</label>
                                                <div class="form-text">Block IPs that trigger high-severity alerts</div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="blockDuration" class="form-label">Block Duration (minutes)</label>
                                                <input type="number" class="form-control" id="blockDuration" value="60" min="5" max="1440">
                                                <div class="form-text">How long to block attacking IPs</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Storage Settings -->
                                    <div class="tab-pane fade" id="storage" role="tabpanel" aria-labelledby="storage-tab">
                                        <h5 class="card-title">Storage Settings</h5>
                                        
                                        <div class="setting-section">
                                            <div class="mb-3">
                                                <label for="dataRetention" class="form-label">Data Retention Period</label>
                                                <select class="form-select" id="dataRetention">
                                                    <option value="7">7 days</option>
                                                    <option value="14">14 days</option>
                                                    <option value="30" selected>30 days</option>
                                                    <option value="90">90 days</option>
                                                    <option value="180">180 days</option>
                                                    <option value="365">1 year</option>
                                                </select>
                                                <div class="form-text">How long to keep traffic and alert data</div>
                                            </div>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="packetCapture" checked>
                                                <label class="form-check-label" for="packetCapture">Store Packet Captures</label>
                                                <div class="form-text">Save full packet data for anomalous traffic</div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="captureFormat" class="form-label">Capture Format</label>
                                                <select class="form-select" id="captureFormat">
                                                    <option value="pcap" selected>PCAP</option>
                                                    <option value="pcapng">PCAPNG</option>
                                                </select>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="maxStorageSize" class="form-label">Maximum Storage (GB)</label>
                                                <input type="number" class="form-control" id="maxStorageSize" value="500" min="10" max="10000">
                                                <div class="form-text">Maximum disk space to use for data storage</div>
                                            </div>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="autoCleanup" checked>
                                                <label class="form-check-label" for="autoCleanup">Automatic Cleanup</label>
                                                <div class="form-text">Automatically remove old data when storage is full</div>
                                            </div>
                                        </div>
                                        
                                        <div class="setting-section">
                                            <h6>Backup</h6>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="enableBackup">
                                                <label class="form-check-label" for="enableBackup">Enable Automatic Backup</label>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="backupSchedule" class="form-label">Backup Schedule</label>
                                                <select class="form-select" id="backupSchedule">
                                                    <option value="daily">Daily</option>
                                                    <option value="weekly" selected>Weekly</option>
                                                    <option value="monthly">Monthly</option>
                                                </select>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="backupLocation" class="form-label">Backup Location</label>
                                                <input type="text" class="form-control" id="backupLocation" value="/mnt/backup">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Users Settings -->
                                    <div class="tab-pane fade" id="users" role="tabpanel" aria-labelledby="users-tab">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h5 class="card-title mb-0">User Management</h5>
                                            <button class="btn btn-sm btn-primary" id="addUserBtn">
                                                <i class="bi bi-person-plus"></i> Add User
                                            </button>
                                        </div>
                                        
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>Username</th>
                                                        <th>Role</th>
                                                        <th>Last Login</th>
                                                        <th>Status</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr>
                                                        <td>admin</td>
                                                        <td>Administrator</td>
                                                        <td>2023-11-15 13:45</td>
                                                        <td><span class="badge bg-success">Active</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-secondary">
                                                                <i class="bi bi-pencil"></i>
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-danger" disabled>
                                                                <i class="bi bi-trash"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>analyst</td>
                                                        <td>Analyst</td>
                                                        <td>2023-11-14 09:20</td>
                                                        <td><span class="badge bg-success">Active</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-secondary">
                                                                <i class="bi bi-pencil"></i>
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-danger">
                                                                <i class="bi bi-trash"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>viewer</td>
                                                        <td>Viewer</td>
                                                        <td>2023-11-10 16:35</td>
                                                        <td><span class="badge bg-secondary">Inactive</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-secondary">
                                                                <i class="bi bi-pencil"></i>
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-danger">
                                                                <i class="bi bi-trash"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                        <div class="setting-section mt-4">
                                            <h6>Authentication Settings</h6>
                                            
                                            <div class="mb-3">
                                                <label for="authMethod" class="form-label">Authentication Method</label>
                                                <select class="form-select" id="authMethod">
                                                    <option value="local" selected>Local Authentication</option>
                                                    <option value="ldap">LDAP</option>
                                                    <option value="oauth">OAuth</option>
                                                </select>
                                            </div>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="twoFactorAuth">
                                                <label class="form-check-label" for="twoFactorAuth">Enable Two-Factor Authentication</label>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="sessionTimeout" class="form-label">Session Timeout (minutes)</label>
                                                <input type="number" class="form-control" id="sessionTimeout" value="30" min="5" max="120">
                                                <div class="form-text">Time after which inactive sessions will be logged out</div>  
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Advanced Settings -->
                                    <div class="tab-pane fade" id="advanced" role="tabpanel" aria-labelledby="advanced-tab">
                                        <h5 class="card-title">Advanced Settings</h5>
                                        
                                        <div class="alert alert-warning">
                                            <i class="bi bi-exclamation-triangle-fill"></i> Warning: These settings are for advanced users only. 
                                            Incorrect configuration may affect system performance and security.
                                        </div>
                                        
                                        <div class="setting-section">
                                            <div class="mb-3">
                                                <label for="logLevel" class="form-label">Log Level</label>
                                                <select class="form-select" id="logLevel">
                                                    <option value="error">Error</option>
                                                    <option value="warning">Warning</option>
                                                    <option value="info" selected>Info</option>
                                                    <option value="debug">Debug</option>
                                                    <option value="trace">Trace</option>
                                                </select>
                                                <div class="form-text">Level of detail in system logs</div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="maxThreads" class="form-label">Max Processing Threads</label>
                                                <input type="number" class="form-control" id="maxThreads" value="4" min="1" max="16">
                                                <div class="form-text">Number of threads for packet processing</div>
                                            </div>
                                            
                                            <div class="form-check form-switch mb-3">
                                                <input class="form-check-input" type="checkbox" id="enableExperimental">
                                                <label class="form-check-label" for="enableExperimental">Enable Experimental Features</label>
                                                <div class="form-text">Access to features under development</div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="apiEndpoint" class="form-label">API Endpoint</label>
                                                <input type="text" class="form-control" id="apiEndpoint" value="/api/v1">
                                                <div class="form-text">Base path for API requests</div>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <label for="customConfig" class="form-label">Custom Configuration</label>
                                                <textarea class="form-control" id="customConfig" rows="4" placeholder="Add custom configuration in JSON format"></textarea>
                                                <div class="form-text">Advanced configuration options</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Initialize Bootstrap tabs
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // Save settings
            document.getElementById('saveSettings').addEventListener('click', function() {
                const settings = {
                    general: {
                        system_name: document.getElementById('systemName').value,
                        timezone: document.getElementById('timezone').value,
                        ui_theme: document.getElementById('uiTheme').value,
                        auto_refresh: document.getElementById('autoRefresh').checked,
                        refresh_interval: document.getElementById('refreshInterval').value
                    },
                    network: {
                        interface: document.getElementById('networkInterface').value,
                        promiscuous_mode: document.getElementById('promiscuousMode').checked,
                        capture_filter: document.getElementById('captureFilter').value,
                        capture_rate: document.getElementById('captureRate').value,
                        internal_networks: document.getElementById('internalNetworks').value,
                        trusted_networks: document.getElementById('trustedNetworks').value
                    },
                    detection: {
                        preferred_model: document.getElementById('preferredModel').value,
                        sensitivity: document.getElementById('detectionSensitivity').value,
                        anomaly_threshold: document.getElementById('anomalyThreshold').value,
                        auto_updates: document.getElementById('automaticUpdates').checked,
                        dynamic_thresholds: document.getElementById('dynamicThresholds').checked,
                        custom_rules: document.getElementById('customRules').value,
                        enable_signatures: document.getElementById('enableSignatures').checked,
                        enable_heuristics: document.getElementById('enableHeuristics').checked
                    },
                    alerts: {
                        alert_threshold: document.getElementById('alertThreshold').value,
                        email_alerts: document.getElementById('emailAlerts').checked,
                        email_recipients: document.getElementById('emailRecipients').value,
                        slack_alerts: document.getElementById('slackAlerts').checked,
                        webhook_alerts: document.getElementById('webhookAlerts').checked,
                        alert_aggregation: document.getElementById('alertAggregation').value,
                        auto_block: document.getElementById('autoBlockAttackers').checked,
                        block_duration: document.getElementById('blockDuration').value
                    },
                    storage: {
                        data_retention: document.getElementById('dataRetention').value,
                        packet_capture: document.getElementById('packetCapture').checked,
                        capture_format: document.getElementById('captureFormat').value,
                        max_storage: document.getElementById('maxStorageSize').value,
                        auto_cleanup: document.getElementById('autoCleanup').checked,
                        enable_backup: document.getElementById('enableBackup').checked,
                        backup_schedule: document.getElementById('backupSchedule').value,
                        backup_location: document.getElementById('backupLocation').value
                    },
                    users: {
                        auth_method: document.getElementById('authMethod').value,
                        two_factor: document.getElementById('twoFactorAuth').checked,
                        session_timeout: document.getElementById('sessionTimeout').value
                    },
                    advanced: {
                        log_level: document.getElementById('logLevel').value,
                        max_threads: document.getElementById('maxThreads').value,
                        experimental: document.getElementById('enableExperimental').checked,
                        api_endpoint: document.getElementById('apiEndpoint').value,
                        custom_config: document.getElementById('customConfig').value
                    }
                };
                
                fetch('/api/settings/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(settings)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        // Show success message
                        const alert = document.createElement('div');
                        alert.className = 'alert alert-success alert-dismissible fade show position-fixed top-0 end-0 m-3';
                        alert.style.zIndex = '1100';
                        alert.innerHTML = `
                            <i class="bi bi-check-circle-fill"></i> Settings saved successfully!
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        `;
                        document.body.appendChild(alert);
                        
                        // Auto-dismiss after 3 seconds
                        setTimeout(() => {
                            alert.classList.remove('show');
                            setTimeout(() => alert.remove(), 150);
                        }, 3000);
                        
                        // Apply theme immediately
                        if (settings.general.ui_theme === 'dark') {
                            document.body.classList.add('dark-theme');
                        } else if (settings.general.ui_theme === 'light') {
                            document.body.classList.remove('dark-theme');
                        } else {
                            // For 'system' option, match the system preference
                            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                                document.body.classList.add('dark-theme');
                            } else {
                                document.body.classList.remove('dark-theme');
                            }
                        }
                    } else {
                        alert('Failed to save settings: ' + (data.message || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Failed to save settings');
                });
            });

            // Reset settings button
            document.getElementById('resetSettings').addEventListener('click', function() {
                if (confirm('Are you sure you want to reset all settings to their default values?')) {
                    fetch('/api/settings/reset', {
                        method: 'POST'
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.status === 'success') {
                            alert('Settings reset successfully');
                            window.location.reload();
                        } else {
                            alert('Failed to reset settings');
                        }
                    });
                }
            });

            // Check for updates
            document.getElementById('checkUpdatesBtn').addEventListener('click', function() {
                fetch('/api/settings/check_updates')
                .then(response => response.json())
                .then(data => {
                    if (data.update_available) {
                        alert(`Update available! Current: ${data.current_version}, Latest: ${data.latest_version}`);
                    } else {
                        alert('Your system is up to date');
                    }
                })
                .catch(error => {
                    console.error('Error checking for updates:', error);
                    alert('Failed to check for updates');
                });
            });

            // Add user button
            document.getElementById('addUserBtn').addEventListener('click', function() {
                // In a real application, this would open a modal or redirect to a user creation page
                alert('Add user functionality would be implemented here');
            });

            // Listen for system theme changes if the theme is set to 'system'
            if (window.matchMedia) {
                const darkModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                darkModeMediaQuery.addListener((e) => {
                    if (document.getElementById('uiTheme').value === 'system') {
                        if (e.matches) {
                            document.body.classList.add('dark-theme');
                        } else {
                            document.body.classList.remove('dark-theme');
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>