<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NMRL NIDS - Alerts</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .card {
            margin-bottom: 20px;
            transition: all 0.2s ease-in-out;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .table-responsive {
            max-height: 400px;
            overflow-y: auto;
        }
        .active-link {
            background-color: rgba(0,0,0,0.1);
            font-weight: bold;
        }
        .alert-badge {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .alert-badge.high {
            background-color: #dc3545;
        }
        .alert-badge.medium {
            background-color: #fd7e14;
        }
        .alert-badge.low {
            background-color: #20c997;
        }
        .alert-card {
            border-left: 4px solid transparent;
            transition: all 0.3s ease;
        }
        .alert-card.high {
            border-left-color: #dc3545;
        }
        .alert-card.medium {
            border-left-color: #fd7e14;
        }
        .alert-card.low {
            border-left-color: #20c997;
        }
        .new-alert {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { background-color: transparent; }
            50% { background-color: rgba(220, 53, 69, 0.1); }
            100% { background-color: transparent; }
        }
        
        /* Dark theme adjustments */
        body.dark {
            background-color: #121212;
            color: #f8f9fa;
        }
        body.dark .sidebar {
            background-color: #1e1e1e !important;
        }
        body.dark .card {
            background-color: #1e1e1e;
            border-color: #2d2d2d;
        }
        body.dark .card-header {
            border-bottom-color: #2d2d2d;
        }
        body.dark .table {
            color: #f8f9fa;
        }
        body.dark .table-hover tbody tr:hover {
            color: #f8f9fa;
            background-color: rgba(255, 255, 255, 0.05);
        }
        body.dark .table-danger {
            background-color: rgba(220, 53, 69, 0.2);
        }
        body.dark .table-warning {
            background-color: rgba(253, 126, 20, 0.2);
        }
        body.dark .table-info {
            background-color: rgba(32, 201, 151, 0.2);
        }
        body.dark .modal-content {
            background-color: #1e1e1e;
            border-color: #2d2d2d;
        }
        body.dark .modal-header {
            border-bottom-color: #2d2d2d;
        }
        body.dark .modal-footer {
            border-top-color: #2d2d2d;
        }
        body.dark pre {
            background-color: #2d2d2d;
            color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body class="{{ theme_class }}">
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('dashboard') }}">
                                <i class="bi bi-speedometer2"></i> NMRL NIDS Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('traffic_monitor') }}">
                                <i class="bi bi-graph-up"></i> Traffic Monitor
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href= "{{ url_for('anomalies') }}">
                                <i class="bi bi-exclamation-triangle"></i> Anomalies
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active-link" href="{{ url_for('alerts') }}">
                                <i class="bi bi-bell"></i> Alerts
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('model_management') }}">
                                <i class="bi bi-cpu"></i> Models
                            </a>
                        </li>
                        <li class="nav-item">
                            
                            <a href="{{ url_for('system_settings_page') }}">
                                <i class="bi bi-gear"></i> Settings
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Security Alerts</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="refreshAlerts()">
                                <i class="bi bi-arrow-clockwise"></i> Refresh
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-primary">
                                <i class="bi bi-download"></i> Export
                            </button>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-sm btn-outline-success" onclick="markAllAsRead()">
                                <i class="bi bi-check-all"></i> Mark All As Read
                            </button>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <!-- Alert Summary -->
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                Alert Summary
                            </div>
                            <div class="card-body">
                                <div class="row text-center">
                                    <div class="col-md-4">
                                        <div class="alert-badge high mx-auto d-block mb-2" style="width: 20px; height: 20px;"></div>
                                        <h3 id="high-alert-count">3</h3>
                                        <p class="text-muted">High</p>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="alert-badge medium mx-auto d-block mb-2" style="width: 20px; height: 20px;"></div>
                                        <h3 id="medium-alert-count">7</h3>
                                        <p class="text-muted">Medium</p>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="alert-badge low mx-auto d-block mb-2" style="width: 20px; height: 20px;"></div>
                                        <h3 id="low-alert-count">12</h3>
                                        <p class="text-muted">Low</p>
                                    </div>
                                </div>
                                
                                <div class="progress mt-4" style="height: 8px;">
                                    <div class="progress-bar bg-danger" role="progressbar" id="high-progress" 
                                         style="width: 14%" 
                                         aria-valuenow="3" aria-valuemin="0" aria-valuemax="22"></div>
                                    <div class="progress-bar bg-warning" role="progressbar" id="medium-progress" 
                                         style="width: 32%" 
                                         aria-valuenow="7" aria-valuemin="0" aria-valuemax="22"></div>
                                    <div class="progress-bar bg-success" role="progressbar" id="low-progress" 
                                         style="width: 54%" 
                                         aria-valuenow="12" aria-valuemin="0" aria-valuemax="22"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card mt-4">
                            <div class="card-header">
                                Alert Trend
                            </div>
                            <div class="card-body">
                                <canvas id="alertTrendChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Alert List -->
                    <div class="col-md-8">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <span>Alert Notifications</span>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="autoRefresh" checked>
                                    <label class="form-check-label" for="autoRefresh">Auto-refresh</label>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="alert-filters mb-3">
                                    <div class="btn-group" role="group">
                                        <input type="radio" class="btn-check" name="severityFilter" id="all" autocomplete="off" checked>
                                        <label class="btn btn-outline-secondary" for="all">All</label>
                                        
                                        <input type="radio" class="btn-check" name="severityFilter" id="high" autocomplete="off">
                                        <label class="btn btn-outline-danger" for="high">High</label>
                                        
                                        <input type="radio" class="btn-check" name="severityFilter" id="medium" autocomplete="off">
                                        <label class="btn btn-outline-warning" for="medium">Medium</label>
                                        
                                        <input type="radio" class="btn-check" name="severityFilter" id="low" autocomplete="off">
                                        <label class="btn btn-outline-success" for="low">Low</label>
                                    </div>
                                </div>
                                
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Severity</th>
                                                <th>Time</th>
                                                <th>Message</th>
                                                <th>Status</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="alerts-table">
                                            <!-- Alert rows will be populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Alert Details -->
                <div class="row mt-4 mb-4">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header">
                                Recent Alert Details
                            </div>
                            <div class="card-body">
                                <div class="row g-4">
                                    <div class="col-md-4">
                                        <div class="card alert-card high new-alert">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <h5 class="card-title mb-0">
                                                        <div class="alert-badge high"></div>
                                                        Critical Security Alert
                                                    </h5>
                                                    <span class="badge bg-danger">
                                                        High
                                                    </span>
                                                </div>
                                                <h6 class="card-subtitle mb-2 text-muted">5 minutes ago</h6>
                                                <p class="card-text">
                                                    DDoS attack detected from multiple source IPs targeting web server.
                                                </p>
                                                <div class="d-flex justify-content-between align-items-center mt-3">
                                                    <small class="text-muted">ID: ALERT-12587</small>
                                                    <div>
                                                        <button class="btn btn-sm btn-outline-primary me-1" onclick="viewAlertDetails('ALERT-12587')">
                                                            <i class="bi bi-eye"></i> View
                                                        </button>
                                                        <button class="btn btn-sm btn-outline-success" onclick="resolveAlert(this, 'ALERT-12587')">
                                                            <i class="bi bi-check-lg"></i> Resolve
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card alert-card medium">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <h5 class="card-title mb-0">
                                                        <div class="alert-badge medium"></div>
                                                        Warning Alert
                                                    </h5>
                                                    <span class="badge bg-warning text-dark">
                                                        Medium
                                                    </span>
                                                </div>
                                                <h6 class="card-subtitle mb-2 text-muted">25 minutes ago</h6>
                                                <p class="card-text">
                                                    Suspicious login attempts detected from unauthorized location.
                                                </p>
                                                <div class="d-flex justify-content-between align-items-center mt-3">
                                                    <small class="text-muted">ID: ALERT-12586</small>
                                                    <div>
                                                        <button class="btn btn-sm btn-outline-primary me-1" onclick="viewAlertDetails('ALERT-12586')">
                                                            <i class="bi bi-eye"></i> View
                                                        </button>
                                                        <button class="btn btn-sm btn-outline-success" onclick="resolveAlert(this, 'ALERT-12586')">
                                                            <i class="bi bi-check-lg"></i> Resolve
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card alert-card low">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-center mb-2">
                                                    <h5 class="card-title mb-0">
                                                        <div class="alert-badge low"></div>
                                                        Informational Alert
                                                    </h5>
                                                    <span class="badge bg-info">
                                                        Low
                                                    </span>
                                                </div>
                                                <h6 class="card-subtitle mb-2 text-muted">2 hours ago</h6>
                                                <p class="card-text">
                                                    Unusual traffic pattern detected from workstation in accounting department.
                                                </p>
                                                <div class="d-flex justify-content-between align-items-center mt-3">
                                                    <small class="text-muted">ID: ALERT-12585</small>
                                                    <div>
                                                        <button class="btn btn-sm btn-outline-primary me-1" onclick="viewAlertDetails('ALERT-12585')">
                                                            <i class="bi bi-eye"></i> View
                                                        </button>
                                                        <button class="btn btn-sm btn-outline-success" onclick="resolveAlert(this, 'ALERT-12585')">
                                                            <i class="bi bi-check-lg"></i> Resolve
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        let alertTrendChart;
        let mockAlerts = [
            { id: 'ALERT-12587', severity: 'high', timestamp: '2025-04-24 13:45:22', message: 'DDoS attack detected from multiple source IPs.', status: 'new', src_ip: '192.168.1.100', dst_ip: '10.0.0.15', details: { protocol: 'TCP', ports: [80, 443], packet_count: 1250 }, email_sent: true },
            { id: 'ALERT-12586', severity: 'high', timestamp: '2025-04-24 12:30:15', message: 'Malicious file download detected on host 192.168.1.45.', status: 'new', src_ip: '45.33.12.78', dst_ip: '192.168.1.45', details: { filename: 'malware.exe', hash: 'a1b2c3d4e5f6' }, email_sent: true },
            { id: 'ALERT-12585', severity: 'high', timestamp: '2025-04-24 10:05:43', message: 'Brute force attack detected against admin login.', status: 'new', src_ip: '78.56.34.12', dst_ip: '10.0.0.10', details: { username: 'admin', attempts: 23 }, email_sent: false },
            { id: 'ALERT-12584', severity: 'medium', timestamp: '2025-04-24 11:22:18', message: 'Suspicious login attempts from unauthorized location.', status: 'new', src_ip: '103.45.67.89', dst_ip: '10.0.0.12', email_sent: true },
            { id: 'ALERT-12583', severity: 'medium', timestamp: '2025-04-24 09:15:32', message: 'Abnormal data transfer detected from database server.', status: 'new', src_ip: '10.0.0.5', dst_ip: '45.67.89.123', details: { data_size: '45MB', protocol: 'FTP' }, email_sent: false },
            { id: 'ALERT-12582', severity: 'medium', timestamp: '2025-04-24 08:43:25', message: 'Multiple failed login attempts for user admin.', status: 'new', src_ip: '192.168.1.25', dst_ip: '10.0.0.10', email_sent: true },
            { id: 'ALERT-12581', severity: 'medium', timestamp: '2025-04-23 23:19:44', message: 'Unusual port scanning activity detected from internal network.', status: 'resolved', src_ip: '192.168.1.33', dst_ip: '10.0.0.0/24', details: { ports_scanned: 45 }, email_sent: true },
            { id: 'ALERT-12580', severity: 'medium', timestamp: '2025-04-23 22:05:33', message: 'Insecure protocol usage detected on finance department network.', status: 'new', src_ip: '192.168.2.15', dst_ip: '192.168.2.10', details: { protocol: 'TLSv1.0' }, email_sent: false },
            { id: 'ALERT-12579', severity: 'medium', timestamp: '2025-04-23 20:41:12', message: 'Unencrypted data transmission detected.', status: 'new', src_ip: '10.0.0.8', dst_ip: 'external.example.com', email_sent: true },
            { id: 'ALERT-12578', severity: 'medium', timestamp: '2025-04-23 19:30:05', message: 'SSH connection attempt with invalid credentials.', status: 'resolved', src_ip: '203.45.67.89', dst_ip: '10.0.0.12', email_sent: true },
            { id: 'ALERT-12577', severity: 'low', timestamp: '2025-04-24 12:10:55', message: 'Unusual traffic pattern from workstation in accounting.', status: 'new', src_ip: '192.168.1.45', dst_ip: '10.0.0.20', email_sent: false },
            { id: 'ALERT-12576', severity: 'low', timestamp: '2025-04-24 11:05:38', message: 'High CPU usage on application server.', status: 'new', src_ip: '10.0.0.15', details: { cpu_usage: '95%', duration: '15 minutes' }, email_sent: true },
            { id: 'ALERT-12575', severity: 'low', timestamp: '2025-04-24 09:50:21', message: 'Non-standard HTTP headers detected in web traffic.', status: 'new', src_ip: '192.168.1.22', dst_ip: '10.0.0.10', details: { headers: ['X-Malicious-Header'] }, email_sent: false },
            { id: 'ALERT-12574', severity: 'low', timestamp: '2025-04-24 08:30:15', message: 'Device connected to network without latest security patches.', status: 'new', src_ip: '192.168.1.67', details: { os: 'Windows 10', missing_patches: 5 }, email_sent: true },
            { id: 'ALERT-12573', severity: 'low', timestamp: '2025-04-23 23:45:33', message: 'Authentication failure threshold exceeded for user jsmith.', status: 'resolved', src_ip: '192.168.1.45', dst_ip: '10.0.0.10', email_sent: true },
            { id: 'ALERT-12572', severity: 'low', timestamp: '2025-04-23 22:20:18', message: 'Outdated browser version detected on executive workstation.', status: 'new', src_ip: '192.168.1.88', details: { browser: 'Chrome 85' }, email_sent: false },
            { id: 'ALERT-12571', severity: 'low', timestamp: '2025-04-23 21:10:05', message: 'Potential data exfiltration attempt detected.', status: 'new', src_ip: '10.0.0.25', dst_ip: 'external.example.com', email_sent: true },
            { id: 'ALERT-12570', severity: 'low', timestamp: '2025-04-23 20:05:22', message: 'Unusual system configuration change detected.', status: 'new', src_ip: '192.168.1.10', details: { change: 'Firewall rule modified' }, email_sent: true },
            { id: 'ALERT-12569', severity: 'low', timestamp: '2025-04-23 19:15:44', message: 'DNS request to known malicious domain blocked.', status: 'resolved', src_ip: '192.168.1.45', dst_ip: 'malicious.example.com', email_sent: false },
            { id: 'ALERT-12568', severity: 'low', timestamp: '2025-04-23 18:30:27', message: 'Unexpected outbound connection attempt from server.', status: 'new', src_ip: '10.0.0.15', dst_ip: 'suspicious.example.com', email_sent: true }
        ];
        
        // Initialize charts on page load
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            refreshAlerts(); // Load initial alerts
            
            // Set up auto-refresh if enabled
            const autoRefreshCheckbox = document.getElementById('autoRefresh');
            let refreshInterval;
            
            function toggleAutoRefresh() {
                if (autoRefreshCheckbox.checked) {
                    refreshInterval = setInterval(refreshAlerts, 10000);
                } else {
                    clearInterval(refreshInterval);
                }
            }
            
            autoRefreshCheckbox.addEventListener('change', toggleAutoRefresh);
            toggleAutoRefresh();
            
            // Set up severity filters
            const filterButtons = document.querySelectorAll('input[name="severityFilter"]');
            filterButtons.forEach(button => {
                button.addEventListener('change', filterAlerts);
            });
        });
        
        function initCharts() {
            // Alert trend chart
            const trendCtx = document.getElementById('alertTrendChart').getContext('2d');
            alertTrendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [
                        {
                            label: 'High',
                            data: [3, 2, 4, 5, 1, 2, 3],
                            borderColor: '#dc3545',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            borderWidth: 2,
                            tension: 0.2,
                            fill: true
                        },
                        {
                            label: 'Medium',
                            data: [5, 4, 7, 3, 6, 4, 5],
                            borderColor: '#fd7e14',
                            backgroundColor: 'rgba(253, 126, 20, 0.1)',
                            borderWidth: 2,
                            tension: 0.2,
                            fill: true
                        },
                        {
                            label: 'Low',
                            data: [7, 6, 8, 9, 7, 6, 8],
                            borderColor: '#20c997',
                            backgroundColor: 'rgba(32, 201, 151, 0.1)',
                            borderWidth: 2,
                            tension: 0.2,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            stacked: false
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // Refresh alerts data
        function refreshAlerts() {
            const alertsTable = document.getElementById('alerts-table');
            
            if (mockAlerts.length === 0) {
                alertsTable.innerHTML = '<tr><td colspan="5" class="text-center">No alerts to display</td></tr>';
            } else {
                alertsTable.innerHTML = mockAlerts.map(alert => `
                    <tr data-alert-id="${alert.id}" class="${alert.severity === 'high' ? 'table-danger' : alert.severity === 'medium' ? 'table-warning' : 'table-info'}">
                        <td>
                            <div class="alert-badge ${alert.severity}"></div>
                            ${alert.severity.charAt(0).toUpperCase() + alert.severity.slice(1)}
                        </td>
                        <td>${alert.timestamp}</td>
                        <td>${alert.message}</td>
                        <td>
                            <span class="badge ${alert.status === 'resolved' ? 'bg-secondary' : 'bg-primary'}">
                                ${alert.status ? alert.status.charAt(0).toUpperCase() + alert.status.slice(1) : 'New'}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-secondary" onclick="viewAlertDetails('${alert.id}')" title="Details">
                                <i class="bi bi-info-circle"></i>
                            </button>
                            ${alert.status !== 'resolved' ? `
                            <button class="btn btn-sm btn-outline-success" onclick="resolveAlert(this, '${alert.id}')" title="Mark as resolved">
                                <i class="bi bi-check-lg"></i>
                            </button>
                            ` : ''}
                        </td>
                    </tr>
                `).join('');
            }
            
            updateAlertCounts();
            filterAlerts();
        }
        
        // Update alert counts in the summary
        function updateAlertCounts() {
            const highAlerts = mockAlerts.filter(alert => alert.severity === 'high' && alert.status !== 'resolved').length;
            const mediumAlerts = mockAlerts.filter(alert => alert.severity === 'medium' && alert.status !== 'resolved').length;
            const lowAlerts = mockAlerts.filter(alert => alert.severity === 'low' && alert.status !== 'resolved').length;
            const totalAlerts = highAlerts + mediumAlerts + lowAlerts;
            
            document.getElementById('high-alert-count').textContent = highAlerts;
            document.getElementById('medium-alert-count').textContent = mediumAlerts;
            document.getElementById('low-alert-count').textContent = lowAlerts;
            
            // Update progress bars
            if (totalAlerts > 0) {
                document.getElementById('high-progress').style.width = (highAlerts / totalAlerts * 100) + '%';
                document.getElementById('medium-progress').style.width = (mediumAlerts / totalAlerts * 100) + '%';
                document.getElementById('low-progress').style.width = (lowAlerts / totalAlerts * 100) + '%';
            } else {
                document.getElementById('high-progress').style.width = '0%';
                document.getElementById('medium-progress').style.width = '0%';
                document.getElementById('low-progress').style.width = '0%';
            }
        }
        
        // Filter alerts by severity
        function filterAlerts() {
            const selectedFilter = document.querySelector('input[name="severityFilter"]:checked').id;
            const rows = document.querySelectorAll('#alerts-table tr');
            
            if (selectedFilter === 'all') {
                rows.forEach(row => {
                    row.style.display = '';
                });
                return;
            }
            
            rows.forEach(row => {
                const severity = row.querySelector('.alert-badge');
                if (!severity) {
                    // This is likely the "No alerts" message row
                    row.style.display = '';
                    return;
                }
                
                if (severity.classList.contains(selectedFilter)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }
        
        // Function to mark an alert as resolved
        function resolveAlert(btn, alertId) {
            // In a real implementation, this would call your API
            // For demo purposes, we'll update the mock data
            
            const alertIndex = mockAlerts.findIndex(alert => alert.id === alertId);
            if (alertIndex !== -1) {
                mockAlerts[alertIndex].status = 'resolved';
                
                // Update the UI
                const row = btn.closest('tr');
                const statusCell = row.querySelector('td:nth-child(4) .badge');
                statusCell.className = 'badge bg-secondary';
                statusCell.textContent = 'Resolved';
                btn.disabled = true;
                
                // Update the alert counts
                updateAlertCounts();
            }
            
            // In a real implementation, you would use:
            /*
            fetch(`/api/alerts/${alertId}/resolve`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    const row = btn.closest('tr');
                    const statusCell = row.querySelector('td:nth-child(4) .badge');
                    statusCell.className = 'badge bg-secondary';
                    statusCell.textContent = 'Resolved';
                    btn.disabled = true;
                    
                    // Update alert counts
                    updateAlertCounts();
                }
            });
            */
        }
        
        // Function to view alert details
        function viewAlertDetails(alertId) {
            // In a real implementation, this would fetch from your API
            // For demo purposes, we'll use the mock data
            
            const alert = mockAlerts.find(a => a.id === alertId);
            if (!alert) return;
            
            // Create a modal to show alert details
            const modalHTML = `
                <div class="modal fade" id="alertDetailsModal" tabindex="-1" aria-labelledby="alertDetailsModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="alertDetailsModalLabel">
                                    Alert Details - ${alert.severity.toUpperCase()}
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>Timestamp:</strong> ${alert.timestamp}</p>
                                        <p><strong>Status:</strong> ${alert.status || 'New'}</p>
                                        <p><strong>Alert ID:</strong> ${alert.id}</p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>Source IP:</strong> ${alert.src_ip || 'N/A'}</p>
                                        <p><strong>Destination IP:</strong> ${alert.dst_ip || 'N/A'}</p>
                                        <p><strong>Email Sent:</strong> ${alert.email_sent ? 'Yes' : 'No'}</p>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <h6>Message:</h6>
                                    <p>${alert.message}</p>
                                </div>
                                ${alert.details ? `
                                <div class="mt-3">
                                    <h6>Details:</h6>
                                    <pre>${JSON.stringify(alert.details, null, 2)}</pre>
                                </div>
                                ` : ''}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                ${alert.status !== 'resolved' ? `
                                <button type="button" class="btn btn-success" onclick="resolveAlertFromModal('${alert.id}')">
                                    <i class="bi bi-check-lg"></i> Resolve
                                </button>
                                ` : ''}
                                <button type="button" class="btn btn-info" onclick="resendAlertEmail('${alert.id}')">
                                    <i class="bi bi-envelope"></i> Resend Email
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add modal to DOM
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalHTML;
            document.body.appendChild(modalContainer);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('alertDetailsModal'));
            modal.show();
            
            // Remove modal when hidden
            document.getElementById('alertDetailsModal').addEventListener('hidden.bs.modal', function() {
                modalContainer.remove();
            });
            
            // In a real implementation, you would use:
            /*
            fetch(`/api/alerts/${alertId}`)
            .then(response => response.json())
            .then(alert => {
                // ... same modal creation code as above ...
            });
            */
        }
        
        function resolveAlertFromModal(alertId) {
            // Find the alert in mock data
            const alertIndex = mockAlerts.findIndex(alert => alert.id === alertId);
            if (alertIndex !== -1) {
                mockAlerts[alertIndex].status = 'resolved';
                
                // Close modal and refresh alerts
                bootstrap.Modal.getInstance(document.getElementById('alertDetailsModal')).hide();
                refreshAlerts();
            }
            
            // In a real implementation, you would use:
            /*
            fetch(`/api/alerts/${alertId}/resolve`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Close modal and refresh alerts
                    bootstrap.Modal.getInstance(document.getElementById('alertDetailsModal')).hide();
                    refreshAlerts();
                }
            });
            */
        }
        
        function resendAlertEmail(alertId) {
            // In a real implementation, this would call your API
            fetch(`/api/alerts/${alertId}/resend_email`, {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    alert('Email notification resent successfully');
                } else {
                    alert('Failed to resend email: ' + data.message);
                }
            });
            
            // For demo purposes with mock data
            const alertIndex = mockAlerts.findIndex(alert => alert.id === alertId);
            if (alertIndex !== -1) {
                mockAlerts[alertIndex].email_sent = true;
                alert('Email notification resent successfully (demo)');
            }
        }
        
        function markAllAsRead() {
            // In a real implementation, this would call your API to mark all as read
            // For demo purposes, we'll update the mock data
            
            mockAlerts.forEach(alert => {
                if (alert.status === 'new') {
                    alert.status = 'read';
                }
            });
            
            refreshAlerts();
            
            // In a real implementation, you would use:
            /*
            fetch('/api/alerts/mark-all-read', {
                method: 'POST'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    refreshAlerts();
                }
            });
            */
        }
        
        // Simulate new alerts occasionally
        setInterval(() => {
            // 20% chance of new alert
            if (Math.random() < 0.2 && document.getElementById('autoRefresh').checked) {
                const severityOptions = ['high', 'medium', 'low'];
                const severity = severityOptions[Math.floor(Math.random() * severityOptions.length)];
                
                const alertMessages = {
                    high: [
                        'Potential data breach detected on finance server.',
                        'Critical vulnerability exploit attempt detected.',
                        'Ransomware activity detected on network.',
                        'Unauthorized access to sensitive data storage.'
                    ],
                    medium: [
                        'Unusual outbound connections detected from workstation.',
                        'Multiple failed authentication attempts from single IP.',
                        'Suspicious process execution detected on server.',
                        'Abnormal user behavior detected on finance system.'
                    ],
                    low: [
                        'Software update available for security components.',
                        'Unusual login time detected for user account.',
                        'Non-compliant device connected to network.',
                        'Outdated SSL certificate detected on internal service.'
                    ]
                };
                
                const message = alertMessages[severity][Math.floor(Math.random() * alertMessages[severity].length)];
                const now = new Date();
                const timestamp = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
                const alertId = `ALERT-${Math.floor(10000 + Math.random() * 90000)}`;
                
                mockAlerts.unshift({
                    id: alertId,
                    severity: severity,
                    timestamp: timestamp,
                    message: message,
                    status: 'new',
                    src_ip: `${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`,
                    dst_ip: `${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}.${Math.floor(Math.random() * 255)}`,
                    email_sent: Math.random() > 0.5
                });
                
                // Keep the list manageable by removing old alerts if needed
                if (mockAlerts.length > 50) {
                    mockAlerts.pop();
                }
                
                refreshAlerts();
                
                // Show notification
                const notification = new bootstrap.Toast(document.getElementById('newAlertNotification'));
                const notificationBody = document.querySelector('#newAlertNotification .toast-body');
                notificationBody.textContent = `New ${severity} alert: ${message}`;
                notification.show();
            }
        }, 30000); // Check every 30 seconds
    </script>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- New Alert Notification Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="newAlertNotification" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header bg-danger text-white">
                <strong class="me-auto">New Alert</strong>
                <small>Just now</small>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <!-- Notification content will be inserted here -->
            </div>
        </div>
    </div>
</body>
</html>